> 状态检查点（2026-02-12）：Stage 1~3C 完成；Stage 3D 进行中；Stage 4 未开始。  
> 本文件是项目阶段状态的唯一口径。

## Stage 1：工程骨架与工具链
**目标**：完成 CMake 化、静态库目标、示例目标、shader 构建链路。  
**验收标准**：可配置、可编译、可链接、可运行占位示例。  
**测试**：`cmake --build` 与基础测试二进制可执行。  
**状态**：已完成。

## Stage 2：核心引擎基础设施
**目标**：完成 Metal 上下文、缓冲分配、配置加载、日志、数学工具、场景基础上传。  
**验收标准**：可初始化设备，可上传几何数据，核心模块有单元测试。  
**测试**：core/rendering/scene 相关单元测试。  
**状态**：已完成。

## Stage 3：硬件 RT 主线
> Stage 3 明确为“硬件优先”，软件/MPS 回退延后到 Stage 4。

### Stage 3A：硬件 RT 计算路径打通
**目标**：完成 BLAS/TLAS 构建与 compute kernel 调度。  
**验收标准**：可输出非黑屏诊断图；能力检测与错误提示明确。  
**测试**：加速结构构建与调度的能力门控测试。  
**状态**：已完成。

### Stage 3B：硬件着色基础对齐
**目标**：对齐 Apple 参考路径，完成 Cornell 基础光照与材质流程。  
**验收标准**：Cornell 可稳定渲染；材质与资源布局可用。  
**测试**：硬件冒烟 + 资源打包测试。  
**状态**：已完成。

### Stage 3C：On-Screen 示例
**目标**：提供窗口化示例，验证交互式运行链路。  
**验收标准**：模式切换、分辨率、截图可用。  
**测试**：人工 checklist + CLI hash 对照。  
**状态**：已完成。

### Stage 3D：扩展着色与性能完善
**目标**：补齐反射/折射/运动模糊等效果，并修正交互路径性能瓶颈。  
**当前事实（代码已体现）**：
- 已有：BRDF 基础着色、软阴影采样、一次反射、材质/纹理上传。
- 已有：`indexOfRefraction` + `materialFlags` 已接入 shader，支持基础折射与全反射回退。
- 已有：交互路径默认不再强制 GPU->CPU 读回与阻塞等待。
- 已有：Cornell 扩展几何中的两球（镜面/折射）稳定可见；用于验证反射/折射主线。
- 已有：Cornell 中 Mario 默认恢复 OBJ 实网格，`mesh8 isolate + instance-trace` 可稳定命中。
- 已有：多帧累积链路已接入（ping-pong + history blend）；当前主线采用固定随机种子与稳定主光线 jitter 以支撑回归。
- 已有：图像回归门禁已接入 CTest（当前采用 Cornell `frames=1` 严格 hash）。
- 未完成：`frames=4/16` 仍以质量回归为主（非严格 hash 门禁）。
- 未完成：Mario OBJ 专项仍需补“视觉质量/性能”验收，而非“可交性”阻断。

**验收标准**：
- 折射路径可用，`indexOfRefraction` 与材质标记生效。
- 交互模式默认无 CPU 读回阻塞，支持多帧累积。
- 新的 hash/截图基线进入文档与测试流程。

**测试**：
- 扩展图像回归（hash 或 image diff）。
- 参数开关（折射、累积、调试模式）组合测试。

**状态**：进行中。

## Stage 4：软件/MPS 回退恢复
**目标**：在硬件路径稳定后恢复软件/MPS 回退，并与硬件路径共享场景/材质布局。  
**前置条件**：Stage 3D 完成并产出稳定基线。  
**状态**：未开始。
